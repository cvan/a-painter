<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Up There WebVR by flimshaw.net</title>
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="icon" href="img/icon-256.png">
    <meta name="description" content="Paint in VR in your browser. Powered by A-Frame.">
    <link href="https://fonts.googleapis.com/css?family=Crimson+Text|Ubuntu" rel="stylesheet">
    <script src="build.js"></script>

    <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16" />
  </head>
  <body>
    <a-scene redux="reducers: worldSettings" pool__star="mixin: star; size: 100;">

      <a-assets>
        <!-- assets -->
        <a-asset-item id="starNames" src="assets/data/starNames.json"></a-asset-item>
        <a-asset-item id="starTypes" src="assets/data/starTypes.json"></a-asset-item>
        <a-asset-item id="exoplanets" src="assets/data/exoplanets.csv"></a-asset-item>
        <a-asset-item id="star-detail-ui-asset" src="assets/models/star-detail-ui.json"></a-asset-item>
        <img id="flimshaw-logo" src="assets/images/flimshaw-logo.png">
        <img id="starmap" src="assets/images/starmap_1024.png">
        <img id="ra-dec-reticle" src="assets/images/ra-dec-reticle.png">
        <!-- mixins -->
        <a-mixin id="star" reticle class="star" scale=".25 .25 .25" action-dispatcher="type: SELECT_STAR; value: -1" hover-text="star"></a-mixin>
      </a-assets>

      <!-- LOADING INDICATOR -->
      <a-entity id="loading" redux-bind="worldSettings.busy: visible" position="0 1.6 -1.6" scale="2 2 2">
        <a-entity>
          <a-entity mixin="crimson" text="value: Up There; align: center; width: 3; height: auto" position="0 .5 0"></a-entity>
          <a-entity mixin="crimson" text="value: Loading stardata...; align: center; width: 1; height: auto" position="0 .35 0"></a-entity>
          <a-entity geometry="primitive: plane" position="0 .15 0" scale=".2 .2 .2"  material="src: #flimshaw-logo; transparent: true; depthWrite: false; depthTest: false"></a-entity>
          <a-entity position="0 0 0" >
            <a-entity mixin="crimson" text="align: center; width: 1; height: auto" position="0 -.05 0" redux-bind="worldSettings.recordCount: text.value"></a-entity>
            <a-entity mixin="crimson" text="value: records; align: center; width: 1; height: auto" position="0 -.1 0"></a-entity>
          </a-entity>
          <a-entity position="0 -.25 0" >
            <a-entity mixin="crimson" text="align: center; width: 1; height: auto" position="0 -.05 0" redux-bind="worldSettings.starCount: text.value"></a-entity>
            <a-entity mixin="crimson" text="value: stars; align: center; width: 1; height: auto" position="0 -.1 0"></a-entity>
          </a-entity>
          <!-- <a-entity mixin="wirecube" position="0 -.42 0" scale=".025 .025 .025">
            <a-animation attribute="rotation" dur="2000" fill="forwards" to="180 360 0" repeat="indefinite"></a-animation>
          </a-entity> -->
        </a-entity>
      </a-entity>

      <!-- STARFIELD -->
      <a-entity id="starfield" position="0 0 -2" rotation="-90 0 0" starfield redux-bind="worldSettings.starDataState: starfield.starDataState; worldSettings.zoomLevel: starfield.zoomLevel; worldSettings.ui.selectedStar: starfield.selectedStar; worldSettings.starDetails: starfield.starDetails">
        <a-entity id="constellations" constellations redux-bind="worldSettings.time: constellations.time" visible="false"></a-entity>
        <a-entity id="star-set-highlighter" star-set-indicator redux-bind="worldSettings.currentStarSet: star-set-indicator.currentStarSet; worldSettings.selectedStar: star-set-indicator.selectedStar" visible="false"></a-entity>
        <a-entity id="sun-indicator" redux-bind="worldSettings.sunIndicator: visible" geometry="primitive: sphere; radius: 1; segmentsWidth: 12; segmentsHeight: 24" material="shader: flat; wireframe: true; color: #aaedff; transparent: true" rotation="90 0 0" visible="false">
          <a-animation attribute="scale" dur="2000" from="0 0 0" to="1 1 1" easing="linear" repeat="indefinite"></a-animation>
          <a-animation attribute="material.opacity" dur="2000" from="1" to="0" repeat="indefinite" fill="backward"></a-animation>
        </a-entity>
        <a-entity id="star-detail-spawner" star-detail-spawner redux-bind="worldSettings.ui.selectedStar: star-detail-spawner.selectedStar; worldSettings.starfieldReady: star-detail-spawner.starfieldReady; worldSettings.zoomLevel: star-detail-spawner.zoomLevel"></a-entity>
      </a-entity>

      <a-entity id="right-hand" gearvr-controls></a-entity>

      <!-- parent object for everything following the user around -->
      <a-entity follow-entity redux-bind="worldSettings.starfieldReady: visible">
        <!-- control panel -->
        <a-entity id="control-panel" position="0 -1.25  -.45" rotation="-75 0 0">

          <!-- EXOPLANET CONTROLS -->
          <a-entity id="exoplanet-controls" position="-.25 0 0">
            <a-entity position="0 .15 0" text="align: center; value: exoplanets; width: 1"></a-entity>
            <a-entity rotation="90 0 0" id="exoplanetsToggle" blend-model="src: assets/models/toggle-switch.json; morphTargets: true; targetObjectName: ToggleSwitch" hover-text="highlight stars with planets" toggle-switch="morph: On" action-dispatcher="type: SELECT_STAR_SET; value: exoplanets" entity-visibility-toggle="target: star-set-highlighter" class="clickable">
              <a-animation attribute="toggle-switch.morphValue" dur="250" begin="stateUpdated" from=0 to=1 direction="alternate"></a-animation>
            </a-entity>
          </a-entity>

          <a-entity id="sun-indicator-controls" position="0 0 0">
            <a-entity position="0 .15 0" text="align: center; value: show sun; width: 1"></a-entity>
            <a-entity rotation="90 0 0" id="exoplanetsToggle" blend-model="src: assets/models/toggle-switch.json; morphTargets: true; targetObjectName: ToggleSwitch" hover-text="show sun/earth location" toggle-switch="morph: On" entity-visibility-toggle="target: sun-indicator" class="clickable">
              <a-animation attribute="toggle-switch.morphValue" dur="250" begin="stateUpdated" from=0 to=1 direction="alternate"></a-animation>
            </a-entity>
          </a-entity>

          <!-- CONSTELLATION CONTROLS -->
          <a-entity id="constellation-controls" position=".25 0 0">
            <a-entity position="0 .15 0" text="align: center; value: constellations; width: 1"></a-entity>
            <a-entity rotation="90 0 0" id="constellationToggle" blend-model="src: assets/models/toggle-switch.json; morphTargets: true; targetObjectName: ToggleSwitch" hover-text="toggle constellation lines" toggle-switch="morph: On" entity-visibility-toggle="target: constellations" class="clickable">
              <a-animation attribute="toggle-switch.morphValue" dur="250" begin="stateUpdated" from=0 to=1 direction="alternate"></a-animation>
            </a-entity>
          </a-entity>

        </a-entity>
      </a-entity>

      <a-entity id="acamera" camera="near: 10e-4; far: 10e10" position="0 1.6 0" gearvr-fly-controls look-controls wasd-controls="fly: true">
        <a-entity id="acursor"
          visible="false"
          cursor="fuse: false; fuseTimeout: 1000"
          raycaster="objects: .clickable; recursive: true; far: 100; near: 0"
          position="0 0 0">
              <a-entity id="cursorIndicator"
                geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.015; segmentsPhi: 1; segmentsTheta: 24;"
                position="0 0 -1"
                material="color: #ffffff; shader: flat; transparent: true; opacity: .5;"
              ></a-entity>
              <a-entity id="cursorHoverText"
                position="0 -.125 -1"
                text="value: ; align: center; width: 2; height: auto; anchor: center"
                hover-text-display
              ></a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="star-detail-parent">
        <a-entity id="star-detail-ui" star-detail-ui scale="0 0 0" visible="false" redux-bind="worldSettings.ui.selectedStar: star-detail-ui.selectedStar; worldSettings.selectedPanel: star-detail-ui.selectedPanel" look-at>
          <a-entity geometry="primitive: box" position="-1 .15 -1" scale=".4 .2 .1" class="clickable" action-dispatcher="type: SELECT_STAR; value: -1" material="color: #cc0000"></a-entity>
        </a-entity>
      </a-entity>
    </a-scene>

    <div id="star-detail">
    </div>

  </body>
</html>
